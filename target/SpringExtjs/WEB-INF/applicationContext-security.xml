<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.1.xsd">

    <!--<global-method-security pre-post-annotations="enabled"/>-->

    <security:http auto-config="false" entry-point-ref="authenticationEntryPoint"> 
        <security:intercept-url pattern="/login*" access="IS_AUTHENTICATED_ANONYMOUSLY"/>
        <security:intercept-url pattern="/js/**" access="IS_AUTHENTICATED_ANONYMOUSLY"/>
        <security:intercept-url pattern="/index*" access="IS_AUTHENTICATED_ANONYMOUSLY" /> 
        <security:intercept-url pattern="/pages/admin.jsp" access="ROLE_ADMIN" />  
        <security:logout logout-success-url="/login.jsp"  invalidate-session="true"/>  
        <security:intercept-url pattern="/pages/main.jsp" access="ROLE_USER,ROLE_ADMIN" />  
        <security:logout logout-success-url="/login.jsp" invalidate-session="true"/>        
        <security:custom-filter position="FORM_LOGIN_FILTER" ref="authenticationFilter" /> 
        <!-- Habilita remember me -->
        <security:remember-me data-source-ref="dataSource"/>
        
    </security:http>
    
    <bean id="authenticationFilter" class="br.org.abmnet.security.AutenticarFilter">
        <property name="authenticationManager" ref="authenticationManager" />
    </bean>
    
    <bean id="authenticationEntryPoint" class="org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint">
        <property name="loginFormUrl" value="/login.jsp" />
    </bean>
    <!-- Permiti security/tags em JSP-->
    <bean id="webexpressionHandler" class="org.springframework.security.web.access.expression.DefaultWebSecurityExpressionHandler" />
    
    <!-- Define a forma de acesso ao dados de usuÃ¡rio, senha e sua respectiva role-->
    <security:authentication-manager alias="authenticationManager">
        <security:authentication-provider>
            <security:password-encoder hash="md5" />
            <security:jdbc-user-service data-source-ref="dataSource"
                               users-by-username-query="SELECT usuario, senha, 'true' as ativo FROM usuarios WHERE usuario=?"
                               authorities-by-username-query="SELECT usuario, autoridade FROM autoridades WHERE usuario=?"
            />
        </security:authentication-provider>
    </security:authentication-manager>
    
    <bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource" >
        <property name="url" value="jdbc:mysql://localhost:3306/demo" />
        <property name="driverClassName" value="com.mysql.jdbc.Driver" />
        <property name="username" value="root" />
        <property name="password" value="16marioe" />
    </bean>
    
    <!--
    Usernames/Passwords are
        moez/moez
        test/test
        scott/wombat
        peter/opal        
    -->
    <!--
    <authentication-manager alias="authenticationManager" >
        <authentication-provider>
            <password-encoder hash="md5"/>
            <user-service>
                <user name="moez" password="f69471ca2c42621b8b8e731b2b4446e4" authorities="ROLE_SUPERVISOR, ROLE_USER, ROLE_TELLER" />
                <user name="test" password="098f6bcd4621d373cade4e832627b4f6" authorities="ROLE_USER" />
                <user name="scott" password="2b58af6dddbd072ed27ffc86725d7d3a" authorities="ROLE_ADMIN" />
                <user name="peter" password="22b5c9accc6e1ba628cedc63a72d57f8" authorities="ROLE_ADMIN" />                
            </user-service>
        </authentication-provider>
    </authentication-manager>
    -->
    
</beans:beans>



